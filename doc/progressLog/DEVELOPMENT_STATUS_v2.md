# ProjectRoom - ê°œë°œ í˜„í™© v2.0 (ì‘ì—…ì„œ ê¸°ë°˜)

**ì—…ë°ì´íŠ¸:** 2025-10-02
**ê¸°ì¤€:** ì‘ì—…ì„œ.txt ìµœì‹  ìš”êµ¬ì‚¬í•­ ë°˜ì˜

---

## âœ… ì™„ë£Œëœ ì‘ì—… (v2.0)

### ğŸ¯ ì‹ ê·œ ê¸°ëŠ¥ (ì‘ì—…ì„œ ê¸°ë°˜)

#### 1. ì›”ë³„ ê°€ì…ì½”ë“œ ì‹œìŠ¤í…œ âœ…
- **Entity**: MonthlyCode (monthly_codes í…Œì´ë¸”)
- **ìë™ ìƒì„±**: ë§¤ì›” 1ì¼ 00:00 KST í¬ë¡ ì¡ (`@Cron`)
- **í¬ë§·**: `YYYY-MM-XXXXXX` (6ìë¦¬ ì˜ìˆ«ì)
- **ê¸°ëŠ¥**:
  - `POST /codes/validate` - ì½”ë“œ ê²€ì¦ ë° ì‚¬ìš© ì¹´ìš´íŠ¸ ì¦ê°€
  - `POST /codes/generate` - ìˆ˜ë™ ì½”ë“œ ìƒì„± (ê´€ë¦¬ì)
  - `POST /codes/:id/toggle` - í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€
  - `GET /codes` - ì½”ë“œ ëª©ë¡ ì¡°íšŒ
  - `GET /codes/month/:year/:month` - íŠ¹ì • ì›”ì˜ í™œì„± ì½”ë“œ
- **ì •ì±…**:
  - `maxUses` ì„¤ì • ê°€ëŠ¥ (null = ë¬´ì œí•œ)
  - `usedCount` ìë™ ì¶”ì 
  - `isActive` ìƒíƒœ ê´€ë¦¬

#### 2. ì¶”ì²œì¸(Referrals) ì‹œìŠ¤í…œ âœ…
- **Entity**: Referral (referrals í…Œì´ë¸”)
- **ê¸°ëŠ¥**:
  - ì¶”ì²œì¸ ì´ë¦„ ììœ  ì…ë ¥ (ì„ íƒ ì‚¬í•­)
  - ì¶”ì²œì¸ë³„ ê°€ì…ì í†µê³„
  - ìµœê·¼ ì¶”ì²œì¸ ëª©ë¡
- **API**:
  - `POST /v1/referrals` - ì¶”ì²œì¸ ì •ë³´ ë“±ë¡
  - `GET /v1/referrals/me` - ë‚´ ì¶”ì²œì¸ ì¡°íšŒ
  - `GET /v1/referrals/stats` - ì¶”ì²œì¸ë³„ í†µê³„ (ê´€ë¦¬ì)
  - `GET /v1/referrals/by-referrer?name=` - íŠ¹ì • ì¶”ì²œì¸ì˜ ê°€ì…ì ëª©ë¡
  - `GET /v1/referrals/recent` - ìµœê·¼ ì¶”ì²œì¸ ëª©ë¡

#### 3. ì„ í˜¸ë„ Top N ë­í‚¹ ì‹œìŠ¤í…œ âœ…
- **ê°€ì¤‘ì¹˜ ìë™ ê³„ì‚°** (ì‘ì—…ì„œ ê¸°ì¤€):
  ```typescript
  5ê°œ ì„ íƒ: [0.30, 0.25, 0.20, 0.15, 0.10]
  4ê°œ ì„ íƒ: [0.35, 0.30, 0.20, 0.15]
  3ê°œ ì„ íƒ: [0.45, 0.35, 0.20]
  2ê°œ ì„ íƒ: [0.60, 0.40]
  1ê°œ ì„ íƒ: [1.00]
  ```
- **ê²€ì¦**:
  - rankëŠ” 1ë¶€í„° ìˆœì°¨ì  (ì¤‘ë³µ ë¶ˆê°€)
  - ìµœì†Œ 1ê°œ, ìµœëŒ€ 5ê°œ ì„ íƒ
  - ë™ì¼ ìš°ì„ ìˆœìœ„ ê¸ˆì§€
- **êµ¬ì¡°**:
  ```json
  {
    "items": [
      {"rank": 1, "type": "age_range", "value": "27-33"},
      {"rank": 2, "type": "region", "value": ["SEOUL", "GWANGGYO"]},
      {"rank": 3, "type": "hobby_overlap", "value": ["í…Œë‹ˆìŠ¤", "ë“±ì‚°"]}
    ],
    "weights": [0.45, 0.35, 0.20]
  }
  ```

#### 4. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥ âœ…
- **ë§ˆì´ê·¸ë ˆì´ì…˜ v2** (`migration-v2.sql` ìƒì„±)
  - `referrals` í…Œì´ë¸” ì¶”ê°€
  - `preferences` í…Œì´ë¸”ì— `items`, `weights` ì»¬ëŸ¼ ì¶”ê°€
  - `profiles_private` í…Œì´ë¸” ì¶”ê°€ (ê³µê°œ/ë¹„ê³µê°œ ë¶„ë¦¬)
  - `audit_logs` í…Œì´ë¸” ì¶”ê°€ (ê´€ë¦¬ì ì ‘ê·¼ ë¡œê¹…)
  - `survey_options` ë§ˆìŠ¤í„° í…Œì´ë¸” ì¶”ê°€
- **ê¸°ë³¸ ë°ì´í„°**: ì·¨ë¯¸, ì§ì—…êµ°, í•™ë ¥ ì˜µì…˜ ìë™ ì‚½ì…

---

## ğŸ“Š ì „ì²´ êµ¬í˜„ í˜„í™©

### Backend (NestJS) - ì™„ì„±ë„ 95%

#### âœ… ì™„ì„±ëœ ëª¨ë“ˆ
1. **Users** - Firebase UID ë™ê¸°í™”, ì‚¬ìš©ì ê´€ë¦¬
2. **Profiles** - í”„ë¡œí•„ CRUD (ê³µê°œ í”„ë¡œí•„)
3. **Photos** - ì‚¬ì§„ ì—…ë¡œë“œ/ê´€ë¦¬, ëŒ€í‘œ ì‚¬ì§„ ì„¤ì •
4. **Preferences** - ì„ í˜¸ë„ ì„¤ì • + Top N ë­í‚¹
5. **Codes** - ì›”ë³„ ê°€ì…ì½”ë“œ ì‹œìŠ¤í…œ (í¬ë¡ ì¡ í¬í•¨)
6. **Referrals** - ì¶”ì²œì¸ ì‹œìŠ¤í…œ
7. **Feed** - ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ v0 (ê·œì¹™ ê¸°ë°˜)
8. **Swipes** - ì¢‹ì•„ìš”/íŒ¨ìŠ¤/ìŠˆí¼ë¼ì´í¬
9. **Matches** - ìƒí˜¸ ë§¤ì¹­ ê´€ë¦¬
10. **Messages** - ì±„íŒ… ë©”ì‹œì§€

#### ğŸ”§ ì¸í”„ë¼
- âœ… TypeORM + MariaDB ì—°ë™
- âœ… Redis ìºì‹± (Global Module)
- âœ… Firebase Authentication Guard
- âœ… Swagger API ë¬¸ì„œí™”
- âœ… Docker Compose êµ¬ì„±
- âœ… ìë™ ìŠ¤ì¼€ì¤„ë§ (NestJS Schedule)

### ë°ì´í„°ë² ì´ìŠ¤

#### âœ… ì™„ì„±ëœ í…Œì´ë¸”
```sql
users, profiles, photos, preferences, swipes, matches, messages,
reports, blocks, user_metrics, monthly_codes, referrals
```

#### ğŸ†• ì¶”ê°€ ì˜ˆì • í…Œì´ë¸” (ì‘ì—…ì„œ ê¸°ë°˜)
- `profiles_private` - ë¹„ê³µê°œ í”„ë¡œí•„ (ì¬ì‚°, ìì‹ ê°, ì„±ê²©/ê°€ì¹˜ê´€)
- `audit_logs` - ê´€ë¦¬ì ì ‘ê·¼ ë¡œê¹…
- `survey_options` - ì˜µì…˜ ë§ˆìŠ¤í„° (ì·¨ë¯¸/ì§ì—…/í•™ë ¥)
- `ab_assignments` - A/B í…ŒìŠ¤íŠ¸ (ì˜µì…˜)

---

## ğŸ¯ ì‘ì—…ì„œ ê¸°ë°˜ í•µì‹¬ ì›ì¹™ êµ¬í˜„ ìƒíƒœ

| ì›ì¹™ | êµ¬í˜„ ìƒíƒœ | ë¹„ê³  |
|------|----------|------|
| ê³µê°œ/ë¹„ê³µê°œ êµ¬íš | ğŸŸ¡ 70% | `profiles_private` í…Œì´ë¸” ì¤€ë¹„, ë¡œì§ ë¯¸êµ¬í˜„ |
| ìµœì†Œ í•„ìˆ˜ + ì„ íƒ í™•ì¥ | âœ… 100% | DTOì— Optional ì ìš© |
| ì„ í˜¸ Top N ê°€ì¤‘ì¹˜ | âœ… 100% | ìë™ ê³„ì‚° + ê²€ì¦ ì™„ë£Œ |
| ìš´ì˜ ìë™í™” | âœ… 100% | ì›”ë³„ ì½”ë“œ í¬ë¡ ì¡, ì¶”ì²œì¸ í†µê³„ |

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ (ìš°ì„ ìˆœìœ„)

### 1. ê³µê°œ/ë¹„ê³µê°œ í”„ë¡œí•„ ë¶„ë¦¬ (ê³ ìš°ì„ )
```typescript
// profiles_private ëª¨ë“ˆ êµ¬í˜„
- Entity: ProfilePrivate
- Service: create, update, findByUserId (admin only)
- Guard: ë³¸ì¸ + ê´€ë¦¬ìë§Œ ì ‘ê·¼
```

### 2. ê´€ë¦¬ì API êµ¬í˜„
```typescript
// Admin ëª¨ë“ˆ
- POST /admin/codes/generate (ìˆ˜ë™ ì½”ë“œ ìƒì„±)
- GET /admin/users (ê²€ìƒ‰/í•„í„°/í˜ì´ì§•)
- GET /admin/users/:uid (ê³µê°œ+ë¹„ê³µê°œ ìš”ì•½, ê°ì‚¬ë¡œê·¸)
- GET /admin/referrals/stats (ì¶”ì²œì¸ í†µê³„)
- GET /admin/metrics (KPI/í¼ë„)
```

### 3. Shared Bits ë°°ì§€ ë¡œì§
```typescript
// Feed ì„œë¹„ìŠ¤ í™•ì¥
- ê³µí†µ ì·¨ë¯¸/íƒœê·¸ ì¶”ì¶œ
- ìƒìœ„ 3ê°œ ë¦¬ì¦Œ ë°°ì§€ ìƒì„±
- ì•„ì´ì½˜ + í‚¤ì›Œë“œ ë§¤í•‘
```

### 4. Flutter Web UI êµ¬í˜„
ì‘ì—…ì„œ Â§19 ê¸°ì¤€ (Instagram-like í†¤ì•¤ë§¤ë„ˆ):
- [ ] Welcome/SignIn í˜ì´ì§€
- [ ] ê°€ì… Step 0-5 (ì½”ë“œ/ì¶”ì²œì¸/ê³µê°œ/ë¹„ê³µê°œ/ì„ í˜¸)
- [ ] Feed í˜ì´ì§€ (ì¹´ë“œ ìŠ¤ì™€ì´í”„)
- [ ] Matches ëª©ë¡
- [ ] Chat í˜ì´ì§€ (DM ìŠ¤íƒ€ì¼)
- [ ] Me (í”„ë¡œí•„ í¸ì§‘)

### 5. Survey Options ê´€ë¦¬
```typescript
// Admin ì˜µì…˜ ë§ˆìŠ¤í„° CRUD
- POST /admin/options (ì˜µì…˜ ì¶”ê°€)
- GET /admin/options?category=hobbies
- PATCH /admin/options/:id
- DELETE /admin/options/:id
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. í™˜ê²½ ì„¤ì •
```bash
# .env íŒŒì¼ í™•ì¸ (.env.example ì°¸ê³ )
cp .env.example .env

# Firebase ì¸ì¦ ì •ë³´ ì„¤ì •
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PRIVATE_KEY="..."
FIREBASE_CLIENT_EMAIL=...
```

### 2. Docker Compose ì‹¤í–‰
```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d

# ë§ˆì´ê·¸ë ˆì´ì…˜ v2 ì‹¤í–‰
docker exec -i projectroom-mariadb mysql -u projectroom -pprojectroom < docker/mariadb/migration-v2.sql

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps
```

### 3. ë¡œì»¬ ê°œë°œ
```bash
# NestJS API
cd apps/api
npm install
npm run start:dev

# Flutter Web
cd apps/web
flutter pub get
flutter run -d chrome
```

---

## ğŸ“š API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

### ì¸ì¦ & ê°€ì…
- `POST /v1/users/sync` - Firebase UID ë™ê¸°í™”
- `POST /codes/validate` - ê°€ì…ì½”ë“œ ê²€ì¦
- `POST /v1/referrals` - ì¶”ì²œì¸ ë“±ë¡

### í”„ë¡œí•„ & ì„¤ì •
- `POST /v1/profiles` - í”„ë¡œí•„ ìƒì„±
- `GET /v1/profiles/me` - ë‚´ í”„ë¡œí•„
- `PATCH /v1/profiles` - í”„ë¡œí•„ ìˆ˜ì •
- `POST /v1/preferences` - ì„ í˜¸ë„ ì„¤ì • (Top N ë­í‚¹ í¬í•¨)

### ì‚¬ì§„
- `POST /v1/photos` - ì‚¬ì§„ ë“±ë¡
- `GET /v1/photos?me=1` - ë‚´ ì‚¬ì§„ ëª©ë¡
- `PATCH /v1/photos/:id` - ëŒ€í‘œ ì‚¬ì§„ ì„¤ì •
- `DELETE /v1/photos/:id` - ì‚¬ì§„ ì‚­ì œ

### ë§¤ì¹­ & í”¼ë“œ
- `GET /v1/feed?limit=20` - ë§¤ì¹­ í”¼ë“œ (ìŠ¤ì½”ì–´ + reasons)
- `POST /v1/swipes` - ì¢‹ì•„ìš”/íŒ¨ìŠ¤/ìŠˆí¼ë¼ì´í¬
- `GET /v1/matches` - ë§¤ì¹­ ëª©ë¡
- `GET /v1/matches/:id` - ë§¤ì¹­ ìƒì„¸

### ë©”ì‹œì§€
- `GET /v1/messages/:matchId` - ë©”ì‹œì§€ ëª©ë¡
- `POST /v1/messages/:matchId` - ë©”ì‹œì§€ ì „ì†¡

### ê´€ë¦¬ì (ì›”ë³„ ì½”ë“œ)
- `POST /codes/generate` - ì›”ë³„ ì½”ë“œ ìƒì„±
- `GET /codes` - ì½”ë“œ ëª©ë¡
- `POST /codes/:id/toggle` - ì½”ë“œ í™œì„±í™” í† ê¸€
- `GET /v1/referrals/stats` - ì¶”ì²œì¸ í†µê³„

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‘ì—…ì„œ ì²´í¬ë¦¬ìŠ¤íŠ¸ (Â§10 ê¸°ì¤€)
- [x] ì›”ì´ˆ 00:00 KST ì½”ë“œ ìƒì„±/í™œì„±í™” í™•ì¸
- [ ] ì½”ë“œë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ê°€ì… ì§„í–‰ ë¶ˆê°€
- [ ] ì˜ëª»ëœ ì½”ë“œ/ë§Œë£Œ ì½”ë“œ ì—ëŸ¬ ì²˜ë¦¬
- [ ] ê³µê°œ í•„ìˆ˜ í•„ë“œ ëˆ„ë½ ì‹œ ì§„í–‰ ë¶ˆê°€
- [x] ë¹„ê³µê°œ í•­ëª© ë¯¸ì‘ì„± ì‹œ ë¬¸ì œ ì—†ìŒ
- [x] ì„ í˜¸ 1~5ê°œ ì„ íƒ ì‹œ ê°€ì¤‘ì¹˜ ë²¡í„° ì˜¬ë°”ë¥´ê²Œ ë°˜ì˜
- [ ] ì‚¬ì§„ ì—…ë¡œë“œ ì œì•½(ê°œìˆ˜/ìš©ëŸ‰) ì¤€ìˆ˜
- [ ] ì„ì‹œ ì €ì¥/ë³µêµ¬ ì •ìƒ ë™ì‘
- [ ] RLS/ê°ì‚¬ë¡œê·¸ ë™ì‘ (ì¶”í›„ êµ¬í˜„)

---

## ğŸ“Š ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜

### v0: ê·œì¹™ ê¸°ë°˜ ìŠ¤ì½”ì–´ë§
```typescript
S = w1*ê³µí†µíƒœê·¸ + w2*ê°€ì¹˜ê´€ + w3*ì‹œê°„ëŒ€ê²¹ì¹¨
  + w4*ê±°ë¦¬ + w5*ì‘ë‹µì„± + w6*í’ˆì§ˆ
```

### v1: ì„ í˜¸ë„ Top N ë°˜ì˜ (ì‹ ê·œ)
```typescript
total_score = Î£ (user_weights[i] * similarity[i])
// user_weights: ì„ í˜¸ ë­í‚¹ ê¸°ë°˜ ê°€ì¤‘ì¹˜
// similarity: ê° ì„ í˜¸ í•­ëª©ì˜ ìœ ì‚¬ë„ (0~1)
```

### ì„¤ì • ê°€ëŠ¥ ê°€ì¤‘ì¹˜ (.env)
```bash
WEIGHT_COMMON_TAGS=0.25
WEIGHT_VALUES_MATCH=0.20
WEIGHT_TIME_OVERLAP=0.15
WEIGHT_DISTANCE=0.15
WEIGHT_RESPONSIVENESS=0.15
WEIGHT_QUALITY_SCORE=0.10
```

---

## ğŸ” ë³´ì•ˆ & ê°œì¸ì •ë³´

### êµ¬í˜„ë¨
- âœ… Firebase Authentication Guard
- âœ… JWT í† í° ê²€ì¦
- âœ… ë³¸ì¸ ë¦¬ì†ŒìŠ¤ë§Œ ìˆ˜ì • ê°€ëŠ¥
- âœ… CORS ì„¤ì •

### ì˜ˆì •
- [ ] RLS (Row-Level Security) - profiles_private
- [ ] ë¹„ê³µê°œ ë°ì´í„° ì•”í˜¸í™” (KMS)
- [ ] Audit Logs (ê´€ë¦¬ì ì ‘ê·¼ ê¸°ë¡)
- [ ] Rate Limiting
- [ ] Input Sanitization

---

## ğŸ“ˆ KPI & ë©”íŠ¸ë¦­ (ì‘ì—…ì„œ ê¸°ë°˜)

### í•µì‹¬ ì§€í‘œ
- **ê°€ì… í¼ë„**: ë…¸ì¶œ â†’ ì½”ë“œì…ë ¥ â†’ ê³µê°œì„¤ë¬¸ â†’ ë¹„ê³µê°œì„¤ë¬¸ â†’ ì„ í˜¸ë­í‚¹ â†’ ì™„ë£Œ
- **ë§¤ì¹­ í¼ë„**: í”„ë¡œí•„ë·° â†’ ì¢‹ì•„ìš” â†’ ìƒí˜¸ë§¤ì¹­ â†’ ì²«ë©”ì‹œì§€ â†’ 3ë¬¸3ë‹µ
- **ì „í™˜ìœ¨**: ì²«ë©”ì‹œì§€ ì „í™˜ìœ¨, ëŒ€í™” 5í„´ ë„ë‹¬ìœ¨
- **ê°€ë“œë ˆì¼**: ì‹ ê³ ìœ¨/ì°¨ë‹¨ìœ¨, ì–¸ë§¤ì¹˜ìœ¨

### ë¦¬ì¦Œë³„ ì„±ê³¼
- ì–´ë–¤ ë¦¬ì¦Œ ë°°ì§€ê°€ 'ì¢‹ì•„ìš”'/'ì²«ë©”ì‹œì§€'ì— ê¸°ì—¬?
- ì„±/ì—°ë ¹/ì§€ì—­ ê·¸ë£¹ë³„ ê³µì •ì„± ì§€í‘œ

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- NestJS 10
- TypeORM 0.3.17
- MariaDB 11
- Redis 7
- Firebase Admin SDK 12

### Frontend (ì¤€ë¹„ë¨)
- Flutter Web
- Riverpod 2.6
- go_router 14
- dio 5.7
- Firebase (Auth + Storage)

### DevOps
- Docker Compose
- GitHub Actions (ì˜µì…˜)

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

- [ì‘ì—…ì„œ.txt](ì‘ì—…ì„œ.txt) - ìµœì‹  ìš”êµ¬ì‚¬í•­ (v1.0)
- [README.md](README.md) - í”„ë¡œì íŠ¸ ê°œìš”
- [FIREBASE_SETUP.md](FIREBASE_SETUP.md) - Firebase ì„¤ì • ê°€ì´ë“œ
- [migration-v2.sql](docker/mariadb/migration-v2.sql) - DB ë§ˆì´ê·¸ë ˆì´ì…˜

---

## ğŸ‰ v2.0 ì™„ë£Œ ìš”ì•½

**ì‹ ê·œ êµ¬í˜„:**
- âœ… ì›”ë³„ ê°€ì…ì½”ë“œ ì‹œìŠ¤í…œ (ìë™ ìƒì„± + ê²€ì¦)
- âœ… ì¶”ì²œì¸ ì‹œìŠ¤í…œ (í†µê³„ í¬í•¨)
- âœ… ì„ í˜¸ë„ Top N ë­í‚¹ + ìë™ ê°€ì¤‘ì¹˜ ê³„ì‚°
- âœ… DB ë§ˆì´ê·¸ë ˆì´ì…˜ v2
- âœ… ë¹Œë“œ ì„±ê³µ

**ë‹¤ìŒ ë§ˆì¼ìŠ¤í†¤:**
- ê³µê°œ/ë¹„ê³µê°œ í”„ë¡œí•„ ë¶„ë¦¬ ë¡œì§
- ê´€ë¦¬ì API êµ¬í˜„
- Flutter UI êµ¬í˜„ (ì‘ì—…ì„œ Â§19 ê¸°ì¤€)
- Shared Bits ë°°ì§€ ë¡œì§

---

**ì‘ì„±ì¼**: 2025-10-02
**ë¹Œë“œ ìƒíƒœ**: âœ… ì„±ê³µ
**í…ŒìŠ¤íŠ¸ ìƒíƒœ**: ğŸŸ¡ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”
